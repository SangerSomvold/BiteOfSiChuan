package com.foomap.activity;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;











import com.foodmap.R;



import com.foomap.model.UserInfo;
import com.foomap.model.UserInfo.UserData;
import com.foomap.util.DraftlvAdapter;
import com.foomap.util.DraftsDbManager;
import com.foomap.view.BaseSwipeListViewListener;
import com.foomap.view.SwipeListView;

import android.app.Activity;
import android.app.ActionBar;
import android.app.Fragment;
import android.content.ContentValues;
import android.content.Intent;
import android.database.Cursor;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.Toast;
import android.os.Build;

public class DraftActivity extends Activity {
	private SwipeListView mSwipeListView;
	private DraftlvAdapter mAdapter;
	public static int deviceWidth;
	private List<String> testData;
	public Button backbtn;
	public Button dv;
	private UserData usr;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_draft);
		usr = UserInfo.getUserData(getApplicationContext());
		// getWindow().setFeatureInt(Window.FEATURE_CUSTOM_TITLE,R.layout.title);
		mSwipeListView = (SwipeListView) findViewById(R.id.draft_lv_list);
		testData = getTestData();
		mAdapter = new DraftlvAdapter(this, R.layout.draftlv_row, testData,
				mSwipeListView);
		deviceWidth = getDeviceWidth();
		mSwipeListView.setAdapter(mAdapter);
		mSwipeListView
				.setSwipeListViewListener(new TestBaseSwipeListViewListener());
		reload();
		dv=(Button)findViewById(R.id.example_row_b_action_1);
		dv.setOnClickListener(listener);
		backbtn = (Button) findViewById(R.id.draftback);
		backbtn.setOnClickListener(listener);
		
		// requestWindowFeature(Window.FEATURE_CUSTOM_TITLE); // ע��˳��
		// setContentView(R.layout.activity_main); // ע��˳��

	}

	private List<String> getTestData() {
		//String[] obj = new String[] { "大宅门火锅", "厕所串串", "利苑", "外婆的厨房", "醉赤壁",
				//		"玉林串串", "蜀九香", "锦城印象", "明廷饭店", "奶茶", "雨田" };
				String[] obj2 = new String[4];
				DraftsDbManager ddm= new DraftsDbManager(getBaseContext());
				Cursor cursor;
				cursor=ddm.queryTheCursor();
				int count=0;
				while (cursor.moveToNext()&&count<=3) { 
				    String muserId = cursor.getString(0); //获取第一列的值,第一列的索引从0开始 
				    if(muserId.equals(getUsername()));
				    {
				    	String mname = cursor.getString(2);
				    	obj2[count]=mname;
				    	count++;
				    }
				} 
				
				//List<String> list = new ArrayList<String>(Arrays.asList(obj));
				List<String> list = new ArrayList<String>(Arrays.asList(obj2));
				return list;
	}

	private int getDeviceWidth() {
		return getResources().getDisplayMetrics().widthPixels;
	}

	private void reload() {
		mSwipeListView.setSwipeMode(SwipeListView.SWIPE_MODE_LEFT);
		mSwipeListView.setSwipeActionLeft(SwipeListView.SWIPE_ACTION_REVEAL);
		// mSwipeListView.setSwipeActionRight(settings.getSwipeActionRight());
		mSwipeListView.setOffsetLeft(deviceWidth * 1 / 2);
		// mSwipeListView.setOffsetRight(convertDpToPixel(settings.getSwipeOffsetRight()));
		mSwipeListView.setAnimationTime(0);
		mSwipeListView.setSwipeOpenOnLongPress(false);
	}
	private String getUsername()
	{
		String userID;
		UserData usr= new UserData();
		userID=usr.userId;
	  
		return userID;
		
		
	}
	class TestBaseSwipeListViewListener extends BaseSwipeListViewListener {

		@Override
		public void onClickFrontView(int position) {
			super.onClickFrontView(position);
			Toast.makeText(getApplicationContext(), testData.get(position),
					Toast.LENGTH_SHORT).show();
		}

		@Override
		public void onDismiss(int[] reverseSortedPositions) {
			for (int position : reverseSortedPositions) {
				testData.remove(position);
			}
			mAdapter.notifyDataSetChanged();
		}
	}

	private OnClickListener listener = new OnClickListener() {

		@Override
		public void onClick(View v) {
			// TODO Auto-generated method stub
			Button btn = (Button) v;
			switch (btn.getId()) {
			
			case R.id.draftback:
				Intent intent = new Intent();
				 intent.setClass(DraftActivity.this,UsrInfoActivity.class);
				 startActivity(intent);
				 finish();
				break;
			case R.id.example_row_b_action_1:
			{
				/*Intent mListIntent = new Intent(DraftActivity.this,CommentNewpositionActivity.class);
			ContentValues cv = new ContentValues();
			cv = mDbManager.queryInfo("fancy","shop");
			mListIntent.putExtra("id",1);
			mListIntent.putExtra("userId", cv.getAsString("userId"));
			mListIntent.putExtra("name", cv.getAsString("name"));
			mListIntent.putExtra("rating", cv.getAsFloat("rating"));
			mListIntent.putExtra("cost", cv.getAsFloat("cost"));
			mListIntent.putExtra("feature", cv.getAsString("feature"));
			mListIntent.putExtra("address", cv.getAsString("address"));
			mListIntent.putExtra("comment", cv.getAsString("comment"));
			mListIntent.putExtra("picture", cv.getAsString("picture"));
				*/
				
				
				break;
				
			}
				
			
			default:
				break;
			}
		}

	};
		
	}



